You are an expert DevOps engineer. Your mission is to deploy the first version of the "Gemini Code Server" (v1) on a secondary port (8080).

1.  **Check Dependencies:**
    * Verify if the `google-genai` python package is installed using `pip list`.
    * If not, install it using `pip install google-genai`.

2.  **Deploy Code:**
    * Create a file named `gemini_server_v1.py` with the EXACT content provided below.
    * This code is pre-configured for PORT 8080.

3.  **Launch Server:**
    * Start the server as a background process using `nohup`.
    * Command: `nohup python3 gemini_server_v1.py > server_v1.log 2>&1 &`
    * IMPORTANT: Use `nohup` and `&` to ensure the agent does not hang waiting for the server to finish.

4.  **Verify:**
    * Wait 5 seconds.
    * Check if the process is running using `ps aux | grep gemini_server_v1.py`.
    * Check the log file `server_v1.log` using `cat` (head/tail) to ensure it started successfully.
    * Verify it is listening using `curl -I http://localhost:8080` or `lsof -i :8080`.

---
[FILE CONTENT FOR gemini_server_v1.py]
import os
import sys
import subprocess
import glob as glob_module
import http.server
import socketserver
import urllib.parse
from google import genai
from google.genai import types

# --- Configuration ---
PORT = 8080
PERSONA_FILE = "hydrated_personas/agent_engineer.md"
MODEL_ID = "gemini-2.0-flash"

# --- 1. Runtime Tool Definitions ---

def Bash(command: str):
    """Executes a command in the bash shell. Use this to run system commands or scripts."""
    print(f"\n[SERVER] ‚ö° Executing Bash: {command}")
    try:
        result = subprocess.run(
            command, shell=True, capture_output=True, text=True, timeout=30
        )
        output = result.stdout + result.stderr
        display_out = output[:200] + "..." if len(output) > 200 else output
        print(f"[SERVER] üì§ Output: {display_out.strip()}")
        return output if output else "(No output)"
    except Exception as e:
        return f"Error executing command: {str(e)}"

def Edit(path: str, content: str):
    """Writes content to a file (overwrites)."""
    print(f"\n[SERVER] ‚úèÔ∏è Editing file: {path}")
    try:
        os.makedirs(os.path.dirname(os.path.abspath(path)), exist_ok=True)
        with open(path, "w") as f:
            f.write(content)
        return f"Successfully wrote to {path}"
    except Exception as e:
        return f"Error writing file: {str(e)}"

def View(path: str):
    """Reads and displays the contents of a file."""
    print(f"\n[SERVER] üëÅÔ∏è Viewing file: {path}")
    if not os.path.exists(path):
        return f"Error: File {path} not found."
    try:
        with open(path, "r") as f:
            return f.read()
    except Exception as e:
        return f"Error reading file: {str(e)}"

def Glob(pattern: str):
    """Lists files matching a pattern (e.g., *.py)."""
    try:
        files = glob_module.glob(pattern, recursive=True)
        return "\n".join(files) if files else "No files found."
    except Exception as e:
        return f"Error listing files: {str(e)}"

def Grep(pattern: str, path: str):
    """Searches files for a pattern using grep."""
    try:
        cmd = ["grep", "-r", pattern, path]
        result = subprocess.run(cmd, capture_output=True, text=True, timeout=10)
        return result.stdout if result.stdout else "No matches found."
    except Exception as e:
        return f"Error executing grep: {str(e)}"

# --- 2. Agent Initialization ---

print("ü§ñ INITIALIZING GEMINI CODE SERVER (Single Page Mode)...")

if not os.path.exists(PERSONA_FILE):
    # Fallback if specific persona missing
    print(f"‚ö†Ô∏è  Warning: {PERSONA_FILE} not found. Using default engineer prompt.")
    SYSTEM_INSTRUCTION = "You are an expert Software Engineer agent. You can execute bash commands, edit files, and view files."
else:
    with open(PERSONA_FILE, "r") as f:
        SYSTEM_INSTRUCTION = f.read()
    print(f"‚úÖ Loaded Persona: {PERSONA_FILE}")

api_key = os.environ.get("GEMINI_API_KEY")
if not api_key:
    print("‚ùå Error: GEMINI_API_KEY not found.")
    sys.exit(1)

client = genai.Client(api_key=api_key)

chat_session = client.chats.create(
    model=MODEL_ID,
    config=types.GenerateContentConfig(
        system_instruction=SYSTEM_INSTRUCTION,
        tools=[Bash, Edit, View, Glob, Grep],
        temperature=0.1,
        automatic_function_calling=types.AutomaticFunctionCallingConfig(
            disable=False,
            maximum_remote_calls=15
        )
    )
)

# --- 3. Server Implementation ---

HTML_TEMPLATE = \"\"\"
<!DOCTYPE html>
<html>
<head>
    <title>Gemini Code Console</title>
    <style>
        body { font-family: 'Segoe UI', monospace; background: #1e1e1e; color: #d4d4d4; margin: 0; padding: 20px; display: flex; flex-direction: column; height: 100vh; box-sizing: border-box;}
        h1 { color: #fff; margin-top: 0; font-size: 1.2rem; border-bottom: 1px solid #333; padding-bottom: 10px; }
        #chat-history { flex: 1; overflow-y: auto; background: #252526; border: 1px solid #3c3c3c; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .msg { margin-bottom: 15px; white-space: pre-wrap; line-height: 1.4; }
        .user-msg { color: #4ec9b0; font-weight: bold; border-left: 3px solid #4ec9b0; padding-left: 10px; }
        .agent-msg { color: #ce9178; border-left: 3px solid #ce9178; padding-left: 10px; }
        form { display: flex; gap: 10px; height: 50px; }
        textarea { flex: 1; background: #3c3c3c; color: #fff; border: 1px solid #007acc; border-radius: 4px; padding: 10px; resize: none; font-family: inherit; }
        textarea:focus { outline: none; background: #444; }
        button { background: #0e639c; color: white; border: none; padding: 0 20px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        button:hover { background: #1177bb; }
    </style>
</head>
<body>
    <h1>ü§ñ Gemini Code Console (Port 8080)</h1>
    <div id="chat-history">
        {{CHAT_HISTORY}}
    </div>
    <form method="POST" action="/">
        <textarea name="prompt" placeholder="Command (e.g. 'ls -la', 'create test.py')..." autofocus></textarea>
        <button type="submit">Run</button>
    </form>
    <script>
        const history = document.getElementById('chat-history');
        history.scrollTop = history.scrollHeight;
        
        document.querySelector('textarea').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.querySelector('form').submit();
            }
        });
    </script>
</body>
</html>
\"\"\"

history_log = []

class GeminiHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        if self.path == "/":
            self.send_response(200)
            self.send_header("Content-type", "text/html")
            self.end_headers()
            
            history_html = ""
            for role, text in history_log:
                css_class = "user-msg" if role == "USER" else "agent-msg"
                safe_text = text.replace("<", "&lt;").replace(">", "&gt;")
                history_html += f'<div class="msg {css_class}"><strong>{role}:</strong>\\n{safe_text}</div>'
            
            if not history_log:
                history_html = '<div class="msg agent-msg">System ready. Waiting for instructions...</div>'

            response_html = HTML_TEMPLATE.replace("{{CHAT_HISTORY}}", history_html)
            self.wfile.write(response_html.encode())
        else:
            super().do_GET()

    def do_POST(self):
        if self.path == "/":
            content_length = int(self.headers['Content-Length'])
            post_data = self.rfile.read(content_length).decode('utf-8')
            params = urllib.parse.parse_qs(post_data)
            user_prompt = params.get('prompt', [''])[0]

            if user_prompt:
                print(f"\\nüì© PROMPT: {user_prompt}")
                history_log.append(("USER", user_prompt))
                try:
                    response = chat_session.send_message(user_prompt)
                    output_text = response.text
                except Exception as e:
                    output_text = f"‚ùå Error: {str(e)}"
                
                history_log.append(("GEMINI", output_text))
            
            self.send_response(303)
            self.send_header("Location", "/")
            self.end_headers()

if __name__ == "__main__":
    print(f"üåç Working Directory: {os.getcwd()}")
    print(f"üì° Serving on Port {PORT}...")
    with socketserver.TCPServer(("", PORT), GeminiHandler) as httpd:
        print(f"‚úÖ Access via http://localhost:{PORT}")
        try:
            httpd.serve_forever()
        except KeyboardInterrupt:
            httpd.server_close()
